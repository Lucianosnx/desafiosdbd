<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Sorteio Desafios Dead By Daylight</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* Seu código CSS aqui */
    *, *::before, *::after {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      background: #1b1b1b;
      color: #f0f0f0;
      font-family: Arial, sans-serif;
      text-align: center;
      height: 100%;
      width: 100%;
    }

    header {
      background: #292929;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    header h1 {
      margin: 0;
      color: #fff;
    }

    .tab-buttons {
      background: #2a2a2a;
      display: flex;
      justify-content: center;
      padding: 10px;
      gap: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    .tab-button-killer {
      background: #ff5c57;
      border: none;
      border-radius: 4px;
      color: #fff;
      font-size: 14px;
      font-weight: bold;
      padding: 10px 20px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .tab-button-killer:hover {
      background: #ff3c37;
    }

    .tab-button-survivors {
      background: #337ab7;
      border: none;
      border-radius: 4px;
      color: #fff;
      font-size: 14px;
      font-weight: bold;
      padding: 10px 20px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .tab-button-survivors:hover {
      background: #285e8e;
    }

    .container {
      padding: 20px;
      padding-bottom: 80px;
      margin: 0 auto;
      max-width: 1200px;
    }
    .tab-content {
      display: none;
      margin: 0 auto;
      max-width: 1200px;
    }

    .flex-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .box {
      background: #2f2f2f;
      border-radius: 8px;
      padding: 20px;
      width: 350px;
      max-width: 90%;
      box-shadow: 0 0 8px rgba(0,0,0,0.3);
      margin: 0 auto;
    }
    .box h2 {
      margin-top: 0;
      color: #ffd47e;
    }

    .red-button {
      background: #ff5c57;
      border: none;
      border-radius: 4px;
      color: #fff;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      padding: 8px 16px;
      margin: 5px;
      transition: background 0.2s ease-in-out;
    }
    .red-button:hover {
      background: #ff3c37;
    }

    .blue-button {
      background: #337ab7;
      border: none;
      border-radius: 4px;
      color: #fff;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      padding: 8px 16px;
      margin: 5px;
      transition: background 0.2s ease-in-out;
    }
    .blue-button:hover {
      background: #285e8e;
    }

    table {
      margin: 0 auto;
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #444;
      word-wrap: break-word;
    }

    #numMortes,
    #numEscapes,
    #coringaSorteado,
    #coringaNumero {
      font-size: 1.5em;
      font-weight: bold;
    }
    #coringaNumero {
      font-size: 2em;
      margin-top: 5px;
    }

    .sortear-tudo {
      margin-top: 30px;
    }

    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #2a2a2a;
      color: #bbb;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px 20px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
      z-index: 1000;
      box-sizing: border-box;
    }
    footer p {
      margin: 0;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }

    @media (max-width: 768px) {
      footer {
        justify-content: flex-end;
        padding: 10px 20px;
      }
      footer p {
        white-space: nowrap;
      }
    }

    @media (max-width: 500px) {
      footer p {
        font-size: 12px;
      }
    }

    #killerImagem {
      width: 200px;
      height: auto;
      margin: 10px auto;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.5);
      display: block;
    }

    .quantity-selector {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 10px 0;
    }
    .quantity-selector button {
      background: #555;
      border: none;
      color: #fff;
      padding: 5px 10px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 4px;
      transition: background 0.2s;
    }
    .quantity-selector button:hover {
      background: #777;
    }
    .quantity-selector span {
      margin: 0 10px;
      font-size: 16px;
      min-width: 20px;
      text-align: center;
    }

    .custom-desafio {
      margin-top: 15px;
    }
    .custom-desafio input {
      width: 80%;
      padding: 6px;
      border: none;
      border-radius: 4px;
      margin-right: 5px;
    }
    .custom-desafio input:focus {
      outline: 2px solid #ff5c57;
    }

    .popup {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      padding: 10px;
    }
    .popup-content {
      background-color: #2f2f2f;
      color: #f0f0f0;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      position: relative;
    }
    .close-button {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #ff5c57;
      border: none;
      border-radius: 4px;
      color: #fff;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      padding: 8px 16px;
      transition: background 0.2s ease-in-out;
    }
    .close-button:hover {
      background: #ff3c37;
    }
    .popup ul {
      list-style: disc;
      text-align: left;
      margin: 10px 0 0;
      padding-left: 20px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Sorteio Desafios Dead By Daylight</h1>
  </header>

  <div class="tab-buttons">
    <button class="tab-button-killer" onclick="openTab('killerTab')">Killer</button>
    <button class="tab-button-survivors" onclick="openTab('survivorTab')">Survivors</button>
  </div>

  <div class="container">
    <div id="killerTab" class="tab-content">
      <div class="flex-row">
        <div class="box">
          <h2>Desafios (Killer)</h2>
          <div class="quantity-selector">
            <button onclick="decrementKillerChallenges()">-</button>
            <span id="killerChallengeCount">4</span>
            <button onclick="incrementKillerChallenges()">+</button>
          </div>
          <table id="tabelaDesafiosKiller">
            <thead>
              <tr><th>Desafio</th><th>Reroll</th></tr>
            </thead>
            <tbody></tbody>
          </table>
          <button class="red-button" onclick="sortearDesafiosKiller()">Sortear Desafios</button>
          <button class="red-button" onclick="verTodosDesafiosKiller()">Ver Todos</button>
          <div class="custom-desafio">
            <input type="text" id="killerCustomInput" placeholder="Digite um desafio customizado (Killer)" />
            <button class="red-button" onclick="adicionarDesafioKiller()">Adicionar</button>
          </div>
        </div>

        <div class="box">
          <h2>Killer Sorteado</h2>
          <p id="killerSorteado">--</p>
          <img id="killerImagem" src="" alt="Killer" style="display: none;" />
          <div style="text-align: center;">
            <button class="red-button" style="display: block; margin: 0 auto;" onclick="sortearKiller()">Sortear Killer</button>
          </div>
        </div>

        <div class="box">
          <h2>Mortes Necessárias (1 a 4)</h2>
          <p id="numMortes">--</p>
          <button class="red-button" onclick="sortearMortes()">Sortear Mortes</button>
        </div>
      </div>
      <div class="sortear-tudo">
        <button class="red-button" onclick="sortearTudoKiller()">Sortear Tudo (Killer)</button>
      </div>
    </div>

    <div id="survivorTab" class="tab-content">
      <div class="flex-row">
        <div class="box">
          <h2>Desafios (Survivors)</h2>
          <div class="quantity-selector">
            <button onclick="decrementSurvivorChallenges()">-</button>
            <span id="survivorChallengeCount">3</span>
            <button onclick="incrementSurvivorChallenges()">+</button>
          </div>
          <table id="tabelaDesafiosSurvivors">
            <thead>
              <tr><th>Desafio</th><th>Reroll</th></tr>
            </thead>
            <tbody></tbody>
          </table>
          <button class="blue-button" onclick="sortearDesafiosSurvivors()">Sortear Desafios</button>
          <button class="blue-button" onclick="verTodosDesafiosSurvivor()">Ver Todos</button>
          <div class="custom-desafio">
            <input type="text" id="survivorCustomInput" placeholder="Digite um desafio customizado (Survivor)" />
            <button class="blue-button" onclick="adicionarDesafioSurvivor()">Adicionar</button>
          </div>
        </div>

        <div class="box">
          <h2>Coringa</h2>
          <p id="coringaSorteado">--</p>
          <p id="coringaNumero">Jogador: --</p>
          <button class="blue-button" onclick="sortearCoringa()">Sortear Coringa</button>
          <button class="blue-button" onclick="sortearNumeroCoringa()">Sortear Número</button>
          <button class="blue-button" onclick="verTodosCoringasSurvivor()">Ver Todos</button>
          <div class="custom-desafio">
            <input type="text" id="coringaCustomInput" placeholder="Digite um coringa customizado" />
            <button class="blue-button" onclick="adicionarCoringa()">Adicionar</button>
          </div>
        </div>

        <div class="box">
          <h2>Escapes Necessários (1 a 4)</h2>
          <p id="numEscapes">--</p>
          <button class="blue-button" onclick="sortearEscapes()">Sortear Escapes</button>
        </div>
      </div>
      <div class="sortear-tudo">
        <button class="blue-button" onclick="sortearTudoSurvivors()">Sortear Tudo (Survivors)</button>
      </div>
    </div>
  </div>

  <footer>
    <p>feito por Sinnex - @lucianosnx</p>
  </footer>

  <div class="popup" id="popupKiller">
    <div class="popup-content">
      <button class="close-button" onclick="closeKillerPopup()">X</button>
      <h2>Todos os Desafios (Killer)</h2>
      <ul id="popupKillerList"></ul>
    </div>
  </div>

  <div class="popup" id="popupSurvivor">
    <div class="popup-content">
      <button class="close-button" onclick="closeSurvivorPopup()">X</button>
      <h2>Todos os Desafios (Survivors)</h2>
      <ul id="popupSurvivorList"></ul>
    </div>
  </div>

  <div class="popup" id="popupCoringa">
    <div class="popup-content">
      <button class="close-button" onclick="closeCoringaPopup()">X</button>
      <h2>Todos os Coringas (Survivors)</h2>
      <ul id="popupCoringaList"></ul>
    </div>
  </div>

  <script>
    /* Seu código JavaScript aqui */
    function capitalizeFirstLetter(str) {
      if (!str) return str;
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    function openTab(tabId) {
      document.getElementById("killerTab").style.display = "none";
      document.getElementById("survivorTab").style.display = "none";
      document.getElementById(tabId).style.display = "block";
    }
    openTab('killerTab');

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    async function fetchChallengesConsolidated(sheetUrl) {
      try {
        const response = await fetch(sheetUrl);
        const data = await response.text();
        const rows = data.split('\n').map(row => row.trim()).filter(row => row);
        const desafiosKiller = [];
        const desafiosSurvivors = [];
        const coringas = [];

        for (let i = 1; i < rows.length; i++) {
          const cols = parseCSVRow(rows[i]);
          if (cols[0]) desafiosKiller.push(cols[0].trim());
          if (cols[2]) desafiosSurvivors.push(cols[2].trim());
          if (cols[3]) coringas.push(cols[3].trim());
        }

        return { desafiosKiller, desafiosSurvivors, coringas };
      } catch (error) {
        console.error('Erro ao buscar desafios:', error);
        return { desafiosKiller: [], desafiosSurvivors: [], coringas: [] };
      }
    }

    function parseCSVRow(row) {
      row = row.replace(/[\r\n]+/g, '').trim();
      return row.split(',');
    }

    const sheetUrlConsolidated = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR2XN6Zw-No0QrY5B_LjjkciQEKlNqKpAyVeQ1_o3pjTD_mA0nuDWlGFEBdprG9bWbWVazzag46eyS8/pub?output=csv';

    let desafiosKiller = [];
    let desafiosSurvivors = [];
    let coringas = [];

    const killers = [
      { name: "The Trapper", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/8/81/K01_TheTrapper_Portrait.png" },
      { name: "The Wraith", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/c/c2/K02_TheWraith_Portrait.png" },
      { name: "The Hillbilly", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/2/24/K03_TheHillbilly_Portrait.png" },
      { name: "The Nurse", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/3/3b/K04_TheNurse_Portrait.png" },
      { name: "The Shape (Michael Myers)", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/b/b5/K05_TheShape_Portrait.png" },
      { name: "The Hag", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/c/c7/K06_TheHag_Portrait.png" },
      { name: "The Doctor", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/5/58/K07_TheDoctor_Portrait.png" },
      { name: "The Huntress", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/f/f1/K08_TheHuntress_Portrait.png" },
      { name: "The Cannibal (Leatherface)", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/6/6f/K09_TheCannibal_Portrait.png" },
      { name: "The Nightmare (Freddy Krueger)", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/d/d5/K10_TheNightmare_Portrait.png" },
      { name: "The Pig", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/5/5c/K11_ThePig_Portrait.png" },
      { name: "The Clown", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/d/d1/K12_TheClown_Portrait.png" },
      { name: "The Spirit", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/f/f1/K13_TheSpirit_Portrait.png" },
      { name: "The Legion", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/5/53/K14_TheLegion_Portrait.png" },
      { name: "The Plague", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/f/fe/K15_ThePlague_Portrait.png" },
      { name: "The Ghost Face", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/d/d1/K16_TheGhostFace_Portrait.png" },
      { name: "The Demogorgon", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/7/75/K17_TheDemogorgon_Portrait.png" },
      { name: "The Oni", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/8/80/K18_TheOni_Portrait.png" },
      { name: "The Deathslinger", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/a/ac/K19_TheDeathslinger_Portrait.png" },
      { name: "The Executioner (Pyramid Head)", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/c/c9/K20_TheExecutioner_Portrait.png" },
      { name: "The Blight", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/1/1f/K21_TheBlight_Portrait.png" },
      { name: "The Twins", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/1/17/K22_TheTwins_Portrait.png" },
      { name: "The Trickster", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/c/c9/K23_TheTrickster_Portrait.png" },
      { name: "The Nemesis", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/6/67/K24_TheNemesis_Portrait.png" },
      { name: "The Cenobite (Pinhead)", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/3/3b/K25_TheCenobite_Portrait.png" },
      { name: "The Artist", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/0/01/K26_TheArtist_Portrait.png" },
      { name: "The Onryō (Sadako)", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/5/5f/K27_TheOnryo_Portrait.png" },
      { name: "The Dredge", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/7/7e/K28_TheDredge_Portrait.png" },
      { name: "The Mastermind (Albert Wesker)", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/e/ec/K29_TheMastermind_Portrait.png" },
      { name: "The Knight", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/6/69/K30_TheKnight_Portrait.png" },
      { name: "The Skull Merchant", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/6/64/K31_TheSkullMerchant_Portrait.png" },
      { name: "The Singularity", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/2/24/K32_TheSingularity_Portrait.png" },
      { name: "The Xenomorph", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/6/64/K33_TheXenomorph_Portrait.png" },
      { name: "Charles Lee Ray (The Good Guy)", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/8/81/K34_TheGoodGuy_Portrait.png" },
      { name: "Unknown (The Unknown)", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/5/51/K35_TheUnknown_Portrait.png" },
      { name: "Vecna (The Lich)", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/f/f0/K36_TheLich_Portrait.png" },
      { name: "Dracula (The Dark Lord)", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/6/62/K37_TheDarkLord_Portrait.png" },
      { name: "Portia Maye (The Houndmaster)", image: "https://static.wikia.nocookie.net/deadbydaylight_gamepedia_en/images/9/96/K38_TheHoundmaster_Portrait.png" }
    ];
    let desafiosKillerSorteados = [];
    let desafiosSurvivorsSorteados = [];
    let coringaSorteado = "--";
    let numeroCoringa = "--";

    let quantidadeDesafiosKiller = 4;
    let quantidadeDesafiosSurvivor = 3;

    function sortearDesafiosKiller() {
      if (desafiosKiller.length === 0) return;
      const tableBody = document.querySelector("#tabelaDesafiosKiller tbody");
      tableBody.innerHTML = "";
      desafiosKillerSorteados = [];
      const shuffledDesafios = shuffleArray([...desafiosKiller]);
      desafiosKillerSorteados = shuffledDesafios.slice(0, quantidadeDesafiosKiller);
      desafiosKillerSorteados.forEach((d, index) => {
        const tr = document.createElement("tr");
        const tdDesafio = document.createElement("td");
        tdDesafio.textContent = capitalizeFirstLetter(d);
        const tdBotao = document.createElement("td");
        const btnReroll = document.createElement("button");
        btnReroll.textContent = "Reroll";
        btnReroll.classList.add("red-button");
        btnReroll.onclick = () => reRollDesafioKiller(index);
        tdBotao.appendChild(btnReroll);
        tr.appendChild(tdDesafio);
        tr.appendChild(tdBotao);
        tableBody.appendChild(tr);
      });
    }

    function reRollDesafioKiller(index) {
      const desafiosDisponiveis = desafiosKiller.filter(
        (d) => !desafiosKillerSorteados.includes(d) || desafiosKillerSorteados[index] === d
      );
      if (desafiosDisponiveis.length === 0) return;
      const novoDesafio = desafiosDisponiveis[Math.floor(Math.random() * desafiosDisponiveis.length)];
      desafiosKillerSorteados[index] = novoDesafio;
      const tableBody = document.querySelector("#tabelaDesafiosKiller tbody");
      const row = tableBody.querySelectorAll("tr")[index];
      row.querySelector("td").textContent = capitalizeFirstLetter(novoDesafio);
    }

    function adicionarDesafioKiller() {
      const input = document.getElementById("killerCustomInput");
      const novoDesafio = input.value.trim();
      if (novoDesafio !== "") {
        desafiosKiller.push(novoDesafio);
        input.value = "";
      }
    }

    function sortearKiller() {
      const killerAleatorio = killers[Math.floor(Math.random() * killers.length)];
      document.getElementById("killerSorteado").textContent = killerAleatorio.name;
      const killerImg = document.getElementById("killerImagem");
      killerImg.src = killerAleatorio.image;
      killerImg.style.display = "block";
    }

    function sortearMortes() {
      const mortes = Math.floor(Math.random() * 4) + 1;
      document.getElementById("numMortes").textContent = mortes;
    }

    function sortearTudoKiller() {
      sortearDesafiosKiller();
      sortearKiller();
      sortearMortes();
    }

    function decrementKillerChallenges() {
      if (quantidadeDesafiosKiller > 1) {
        quantidadeDesafiosKiller--;
        document.getElementById("killerChallengeCount").textContent = quantidadeDesafiosKiller;
        sortearDesafiosKiller();
      }
    }

    function incrementKillerChallenges() {
      if (quantidadeDesafiosKiller < 10) {
        quantidadeDesafiosKiller++;
        document.getElementById("killerChallengeCount").textContent = quantidadeDesafiosKiller;
        sortearDesafiosKiller();
      }
    }

    function verTodosDesafiosKiller() {
      let list = "";
      for (let d of desafiosKiller) {
        list += "<li>" + capitalizeFirstLetter(d) + "</li>";
      }
      document.getElementById("popupKillerList").innerHTML = list;
      document.getElementById("popupKiller").style.display = "flex";
    }

    function closeKillerPopup() {
      document.getElementById("popupKiller").style.display = "none";
    }

    function sortearDesafiosSurvivors() {
      if (desafiosSurvivors.length === 0) return;
      const tableBody = document.querySelector("#tabelaDesafiosSurvivors tbody");
      tableBody.innerHTML = "";
      desafiosSurvivorsSorteados = [];
      const shuffledDesafios = shuffleArray([...desafiosSurvivors]);
      desafiosSurvivorsSorteados = shuffledDesafios.slice(0, quantidadeDesafiosSurvivor);
      desafiosSurvivorsSorteados.forEach((d, index) => {
        const tr = document.createElement("tr");
        const tdDesafio = document.createElement("td");
        tdDesafio.textContent = capitalizeFirstLetter(d);
        const tdBotao = document.createElement("td");
        const btnReroll = document.createElement("button");
        btnReroll.textContent = "Reroll";
        btnReroll.classList.add("blue-button");
        btnReroll.onclick = () => reRollDesafioSurvivors(index);
        tdBotao.appendChild(btnReroll);
        tr.appendChild(tdDesafio);
        tr.appendChild(tdBotao);
        tableBody.appendChild(tr);
      });
    }

    function reRollDesafioSurvivors(index) {
      const desafiosDisponiveis = desafiosSurvivors.filter(
        (d) => !desafiosSurvivorsSorteados.includes(d) || desafiosSurvivorsSorteados[index] === d
      );
      if (desafiosDisponiveis.length === 0) return;
      const novoDesafio = desafiosDisponiveis[Math.floor(Math.random() * desafiosDisponiveis.length)];
      desafiosSurvivorsSorteados[index] = novoDesafio;
      const tableBody = document.querySelector("#tabelaDesafiosSurvivors tbody");
      const row = tableBody.querySelectorAll("tr")[index];
      row.querySelector("td").textContent = capitalizeFirstLetter(novoDesafio);
    }

    function adicionarDesafioSurvivor() {
      const input = document.getElementById("survivorCustomInput");
      const novoDesafio = input.value.trim();
      if (novoDesafio !== "") {
        desafiosSurvivors.push(novoDesafio);
        input.value = "";
      }
    }

    function sortearEscapes() {
      const escapes = Math.floor(Math.random() * 4) + 1;
      document.getElementById("numEscapes").textContent = escapes;
    }

    function sortearTudoSurvivors() {
      sortearDesafiosSurvivors();
      sortearEscapes();
      sortearCoringa();
      sortearNumeroCoringa();
    }

    function decrementSurvivorChallenges() {
      if (quantidadeDesafiosSurvivor > 1) {
        quantidadeDesafiosSurvivor--;
        document.getElementById("survivorChallengeCount").textContent = quantidadeDesafiosSurvivor;
        sortearDesafiosSurvivors();
      }
    }

    function incrementSurvivorChallenges() {
      if (quantidadeDesafiosSurvivor < 10) {
        quantidadeDesafiosSurvivor++;
        document.getElementById("survivorChallengeCount").textContent = quantidadeDesafiosSurvivor;
        sortearDesafiosSurvivors();
      }
    }

    function verTodosDesafiosSurvivor() {
      let list = "";
      for (let d of desafiosSurvivors) {
        list += "<li>" + capitalizeFirstLetter(d) + "</li>";
      }
      document.getElementById("popupSurvivorList").innerHTML = list;
      document.getElementById("popupSurvivor").style.display = "flex";
    }

    function closeSurvivorPopup() {
      document.getElementById("popupSurvivor").style.display = "none";
    }

    function sortearCoringa() {
      if (coringas.length === 0) {
        coringaSorteado = "--";
      } else {
        const coringaAleatorio = coringas[Math.floor(Math.random() * coringas.length)];
        coringaSorteado = coringaAleatorio;
      }
      document.getElementById("coringaSorteado").textContent = coringaSorteado;
    }

    function sortearNumeroCoringa() {
      const numero = Math.floor(Math.random() * 4) + 1;
      numeroCoringa = numero;
      document.getElementById("coringaNumero").textContent = "Jogador: " + numeroCoringa;
    }

    function verTodosCoringasSurvivor() {
      let list = "";
      for (let d of coringas) {
        list += "<li>" + capitalizeFirstLetter(d) + "</li>";
      }
      document.getElementById("popupCoringaList").innerHTML = list;
      document.getElementById("popupCoringa").style.display = "flex";
    }

    function closeCoringaPopup() {
      document.getElementById("popupCoringa").style.display = "none";
    }

    function adicionarCoringa() {
      const input = document.getElementById("coringaCustomInput");
      const novoCoringa = input.value.trim();
      if (novoCoringa !== "") {
        coringas.push(novoCoringa);
        input.value = "";
      }
    }

    async function carregarPlanilhaConsolidada() {
      const { desafiosKiller: dk, desafiosSurvivors: ds, coringas: c } = await fetchChallengesConsolidated(sheetUrlConsolidated);
      desafiosKiller = dk;
      desafiosSurvivors = ds;
      coringas = c;
    }

    window.onload = async function() {
      await carregarPlanilhaConsolidada();
      sortearDesafiosKiller();
      sortearDesafiosSurvivors();
      coringaSorteado = "--";
      numeroCoringa = "--";
      document.getElementById("coringaSorteado").textContent = coringaSorteado;
      document.getElementById("coringaNumero").textContent = "Jogador: " + numeroCoringa;
    };
  </script>
</body>
</html>
